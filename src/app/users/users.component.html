<div class="search-input">
  <input type="text" placeholder="Search by First Name" (input)="search()" [(ngModel)]="nameQuery">
  <input type="text" placeholder="Search by Last Name" (input)="search()" [(ngModel)]="surnameQuery">
</div>

@if(!userFormActive) {
  <div class="button-container">
    <button (click)="this.userFormActive = true">Add new user</button>
  </div>
}

@if(userFormActive) {
  <div class="add-user-container">
    <form [formGroup]="userForm" (ngSubmit)="addUserHandler()">
      <label>
        First name:
        <input type="text" placeholder="Mark" formControlName="name" />
      </label>
      <label>
        Last name:
        <input type="text" placeholder="Watson" formControlName="surname" />
      </label>
      <label>
        Birth date:
        <input type="date" formControlName="birthday" />
      </label>
      <label>
        Email:
        <input type="email" placeholder="mark.watson@email.com" formControlName="email" />
      </label>
      <div class="button-container">
        <button (click)="hideForm()">Cancel</button>
        <button type="submit">Add</button>
      </div>
      @if(userFeedbackMessage) {
        <p>
          {{ userFeedbackMessage }}
        </p>
      }
    </form>
  </div>
}

@if(fetchingUsers || fetchingAbsencesDefinitions) {
  <div class="info-container">
    <p>
      Fetching users...
    </p>
  </div>
}

@if(!fetchingUsers && !fetchingAbsencesDefinitions) {
  @if(filteredUsers.length > 0) {
    <div class="users-container">
      <table>
        <thead>
        <tr>
          <th>First name</th>
          <th>Last name</th>
          <th>Birth date</th>
          <th>Email</th>
        </tr>
        </thead>
        <tbody>
          @for(user of filteredUsers; track user.Id) {
            <tr>
              <td>{{ user.FirstName }}</td>
              <td>{{ user.LastName }}</td>
              <td>{{ user.BirthDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ user.Email }}</td>
              <td>
                <a (click)="user.absenceFormActive = !user.absenceFormActive; absenceFeedbackMessage='';">âœš</a>
              </td>
            </tr>
            @if(user.absenceFormActive) {
              <tr>
                <td colspan="99">
                  <form [formGroup]="absenceForm" (ngSubmit)="addAbsenceHandler(user.Id)">
                    <div class="input-container">
                      <label>
                        Select type of absence
                        <select formControlName="absenceId">
                          @for(absDef of absenceDefinitions; track absenceDefinitions.Id) {
                            <option [value]="absDef.Id">
                              {{ absDef.Name }}
                            </option>
                          }
                        </select>
                      </label>
                      <label>
                        Select absence start
                        <input type="date" formControlName="startDate" />
                      </label>
                      <label>
                        Select absence end
                        <input type="date" formControlName="endDate" />
                      </label>
                    </div>
                    <div class="button-and-feedback-container">
                      <button type="submit">
                        Add absence
                      </button>
                      @if(absenceFeedbackMessage) {
                        <div class="info-container">
                          {{ absenceFeedbackMessage }}
                        </div>
                      }
                    </div>
                  </form>
                </td>
              </tr>
            }
          }
      </table>
    </div>
  }

  @if(users.length == 0) {
    <div class="info-container">
      <p>
        No users found.
      </p>
    </div>
  }

  @if(users.length > 0 && filteredUsers.length == 0) {
    <div class="info-container">
      <p>
        No users match search criteria.
      </p>
    </div>
  }
}

