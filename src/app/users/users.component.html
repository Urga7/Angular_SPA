<div class="search-input">
  <input type="text" placeholder="Search by First Name" (input)="search('FirstName', nameQuery)" [(ngModel)]="nameQuery">
  <input type="text" placeholder="Search by Last Name" (input)="search('LastName', surnameQuery)" [(ngModel)]="surnameQuery">
</div>

@if(!userFormActive) {
  <div class="button-container">
    <button (click)="this.userFormActive = true">Add new user</button>
  </div>
}

@if(userFormActive) {
  <div class="add-user-container">
    <form [formGroup]="userForm" (ngSubmit)="addUserHandler()">
      <label>
        First name:
        <input type="text" placeholder="Mark" formControlName="name" />
      </label>
      <label>
        Last name:
        <input type="text" placeholder="Watson" formControlName="surname" />
      </label>
      <label>
        Birth date:
        <input type="date" formControlName="birthday" />
      </label>
      <label>
        Email:
        <input type="email" placeholder="mark.watson@email.com" formControlName="email" />
      </label>
      <div class="button-container">
        <button (click)="hideForm()">Cancel</button>
        <button type="submit">Add</button>
      </div>
      @if(userSuccessMessage) {
        <p class="success-msg">
          {{ userSuccessMessage }}
        </p>
      }
      @if(userErrorMessage) {
        <p class="error-msg">
          {{ userErrorMessage }}
        </p>
      }
      @if(userInfoMessage) {
        <p>
          {{ userInfoMessage }}
        </p>
      }
    </form>
  </div>
}

@if(fetchingUsers || fetchingAbsencesDefinitions) {
  <div class="info-container">
    <p>
      Fetching users...
    </p>
  </div>
}

@if(!fetchingUsers && !fetchingAbsencesDefinitions) {
  @if(filteredUsers.length > 0) {
    <div class="users-container">
      <table>
        <thead>
        <tr>
          <th>First name</th>
          <th>Last name</th>
          <th>Birth date</th>
          <th>Email</th>
        </tr>
        </thead>
        <tbody>
          @for(user of filteredUsers; track user.Id) {
            <tr>
              <td>{{ user.FirstName }}</td>
              <td>{{ user.LastName }}</td>
              <td>{{ user.BirthDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ user.Email }}</td>
              <td>
                <a (click)="user.absenceFormActive = !user.absenceFormActive">âœš</a>
              </td>
            </tr>
            @if(user.absenceFormActive) {
              <tr>
                <td colspan="5" class="add-absence-container">
                  <form [formGroup]="absenceForm" (ngSubmit)="addAbsenceHandler(user.Id)">
                    <label>
                      Select type of absence
                      <select formControlName="absenceId">
                        @for(absDef of absenceDefinitions; track absenceDefinitions.Id) {
                          <option [value]="absDef.Id">
                            {{ absDef.Name }}
                          </option>
                        }
                      </select>
                    </label>
                    <label>
                      Select absence start
                      <input type="date" formControlName="startDate" />
                    </label>
                    <label>
                      Select absence end
                      <input type="date" formControlName="endDate" />
                    </label>
                    <button type="submit">
                      Add absence
                    </button>
                  </form>
                </td>
              </tr>
            }
          }
      </table>
    </div>
  }

  @if(users.length == 0) {
    <div class="info-container">
      <p>
        No users found.
      </p>
    </div>
  }

  @if(users.length > 0 && filteredUsers.length == 0) {
    <div class="info-container">
      <p>
        No users match search criteria.
      </p>
    </div>
  }
}

